/**
 * Authentication E2E Tests
 * Sample tests demonstrating the E2E testing patterns
 *
 * Generated by: create-e2e-docker
 */

import { test, expect, TEST_USERS } from "../fixtures";
import { LoginPage } from "../pages/login.page";

test.describe("Authentication", () => {
  let loginPage: LoginPage;

  test.beforeEach(async ({ page }) => {
    loginPage = new LoginPage(page);
  });

  test("should display login page correctly", async ({ page }) => {
    await loginPage.navigate();
    await loginPage.expectPageLoaded();
  });

  test("should login successfully with valid credentials", async ({ page }) => {
    const user = TEST_USERS.<%= testUsers[0]?.role || 'user' %><%= testUsers.length > 1 ? '1' : '' %>;

    await loginPage.login(user.email, user.password);

    // Should redirect away from login page
    await expect(page).not.toHaveURL(/<%= auth.loginPath %>/);
  });

  test("should show error with invalid credentials", async ({ page }) => {
    await loginPage.navigate();
    await loginPage.fillCredentials("invalid@example.com", "wrongpassword");
    await loginPage.submit();

    await loginPage.expectLoginError();
  });

  test("should navigate to register page", async ({ page }) => {
    await loginPage.navigate();
    await loginPage.goToRegister();

    await expect(page).toHaveURL(/register/);
  });
});

test.describe("Authenticated Routes", () => {
  test.use({ storageState: undefined }); // Ensure fresh session

  test("should access protected route after login", async ({ authenticatedPage }) => {
    await authenticatedPage.goto("<%= auth.dashboardPath %>");

    // Should be on dashboard, not redirected to login
    await expect(authenticatedPage).toHaveURL(/<%= auth.dashboardPath %>/);
  });

  test("should redirect to login when not authenticated", async ({ page }) => {
    await page.goto("<%= auth.dashboardPath %>");

    // Should redirect to login
    await expect(page).toHaveURL(/<%= auth.loginPath %>/);
  });
});
